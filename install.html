<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Installation &#8212; workflow-api 0.1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="_static/basic.css?v=b08954a9" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=27fed22d" />
    <script src="_static/documentation_options.js?v=01f34227"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs"></script>
    <script type="module" src="https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs"></script>
    <script type="module">import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";import elkLayouts from "https://cdn.jsdelivr.net/npm/@mermaid-js/layout-elk@0.1.4/dist/mermaid-layout-elk.esm.min.mjs";mermaid.registerLayoutLoaders(elkLayouts);mermaid.initialize({startOnLoad:false});</script>
    <script src="https://cdn.jsdelivr.net/npm/d3@7.9.0/dist/d3.min.js"></script>
    <script type="module">
import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@11.2.0/dist/mermaid.esm.min.mjs";
window.addEventListener("load", () => mermaid.run());
</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Usage" href="use.html" />
    <link rel="prev" title="Welcome to the workflow-api documentation!" href="index.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="installation">
<h1>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h1>
<p>This section describes how to install the LabCas Workflow API on AWS.</p>
<p>LabCas Workflows is meant to be installed on an Amazon Web Service account.</p>
<section id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Link to this heading">¶</a></h2>
<p>What you need to install LabCas Workflows is:</p>
<ul class="simple">
<li><p>System administrator support to comply with the security constraints defined by your organization.</p></li>
<li><p>An AWS account with a VPC and private subnets</p></li>
</ul>
<p>Some knowledge of the AWS console and AWS CLI is helpful.</p>
</section>
<section id="architecture-overview">
<h2>Architecture Overview<a class="headerlink" href="#architecture-overview" title="Link to this heading">¶</a></h2>
<p>The LabCas workflow API is a sub-component of the <a class="reference external" href="https://jpl-labcas.github.io/workflows/">LabCas Workflows documentation</a> system, which relies on several AWS services to function properly.</p>
<p>See the architecture diagram in the <a class="reference external" href="https://jpl-labcas.github.io/workflows/install.html#architecture-overview">LabCas Workflows documentation</a> for more details on the high level architecture.</p>
<p>The API component is responsible for handling RESTFul API requests, managing workflow definitions, and orchestrating workflow executions. It interacts with other components such as the workflow engine (e.g., Apache Airflow) and storage services (e.g., S3 buckets) by providing logical access (workflows, datasets) to the users according to their authorizations and without exposing the actual infrastructure (workflow engine, computing resources, storage).</p>
<p>The API is deployed as an AWS/API Gateway. Each API endpoint correspond to specific functions implemented with AWS/Lambda functions that process the requests and interact with other AWS services as needed.</p>
<pre  class="mermaid">
        graph TD
  subgraph LabCas API
    F[AWS API Gateway]
    J[Authorizer Lambda]
    K[Implementation Lambda Functions]
    F --&gt; J
    F --&gt; K
  end
  subgraph LabCas Workflows
    G[Workflow_Engine_Airflow]
    H[(DAG_S3_bucket)]
    I[(Staging_S3_bucket)]
    K --&gt; G
    K --&gt; I
    G --&gt; H
    G --&gt; I
  end
    </pre></section>
<section id="doing-the-installation">
<h2>Doing the Installation<a class="headerlink" href="#doing-the-installation" title="Link to this heading">¶</a></h2>
<section id="create-the-implementation-lambda-functions">
<h3>Create the implementation lambda functions<a class="headerlink" href="#create-the-implementation-lambda-functions" title="Link to this heading">¶</a></h3>
</section>
</section>
<section id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Link to this heading">¶</a></h2>
<p>Create a parameter in the Parameter Store of the AWS System Manager, with reference name <code class="docutils literal notranslate"><span class="pre">/labcas/workflow/api/config</span></code>:</p>
<p>The YAML content is as follows (update the values as needed):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">collections</span><span class="p">:</span>
    <span class="p">{</span><span class="n">archive</span> <span class="n">dataset</span> <span class="n">name</span> <span class="mi">1</span><span class="p">}:</span>
        <span class="n">bucket</span><span class="p">:</span> <span class="p">{</span><span class="n">s3</span> <span class="n">bucket</span> <span class="n">where</span> <span class="n">the</span>  <span class="n">data</span> <span class="ow">is</span> <span class="n">stored</span><span class="p">}</span>
        <span class="n">prefix</span><span class="p">:</span> <span class="p">{</span><span class="n">s3</span> <span class="n">prefix</span> <span class="n">where</span> <span class="n">the</span> <span class="n">data</span> <span class="ow">is</span> <span class="n">stored</span> <span class="ow">in</span> <span class="n">the</span> <span class="n">above</span> <span class="n">bucket</span><span class="p">}</span><span class="o">/</span>
        <span class="n">workflows</span><span class="p">:</span>
            <span class="p">{</span><span class="nb">id</span> <span class="n">of</span> <span class="n">a</span> <span class="n">deployed</span> <span class="n">airflow</span> <span class="n">workflow</span> <span class="p">(</span><span class="n">aka</span> <span class="n">DAG</span><span class="p">)}:</span>
               <span class="n">authorized_users</span><span class="p">:</span>
                  <span class="o">-</span> <span class="p">{</span><span class="n">authorized</span> <span class="n">user</span> <span class="mi">1</span><span class="p">,</span> <span class="n">using</span> <span class="n">labcas</span> <span class="n">authentication</span><span class="p">}</span>
                  <span class="o">-</span> <span class="p">{</span><span class="n">authorized</span> <span class="n">user</span> <span class="mi">2</span><span class="p">,</span> <span class="n">using</span> <span class="n">labcas</span> <span class="n">authentication</span><span class="p">}</span>
                  <span class="o">-</span> <span class="o">...</span>
    <span class="p">{</span><span class="n">archive</span> <span class="n">dataset</span> <span class="n">name</span> <span class="mi">1</span><span class="p">}:</span>
        <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="lambda-role">
<h2>lambda role<a class="headerlink" href="#lambda-role" title="Link to this heading">¶</a></h2>
<p>Create an IAM role for the lambda functions with the following policies:</p>
<ul class="simple">
<li><p>AWSLambdaBasicExecutionRole</p></li>
<li><p>AWSLambdaVPCAccessExecutionRole</p></li>
<li><p>And a specific policy to access:
- MWAA Full: Read Limited: Write
- S3 Limited to the staging bucket and archive bucket: List, Read, Write
- Systems Manager Limited on dedicated config parameter: Read</p></li>
</ul>
</section>
<section id="layer">
<h2>Layer<a class="headerlink" href="#layer" title="Link to this heading">¶</a></h2>
<p>Layer deployment is part of the terraform deployment of the lambda functions.</p>
<p>A layer is a lambda component containing re-usable functions. We use it for the code helping to connect to the restful API.</p>
<p>Package it as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">./</span><span class="n">terraform</span><span class="o">/</span><span class="n">applications</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">lambdas</span><span class="o">/</span>
<span class="n">rm</span> <span class="o">-</span><span class="n">fr</span> <span class="n">build</span>
<span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">t</span> <span class="n">src</span><span class="o">/</span><span class="n">layer</span><span class="o">/</span><span class="n">python</span>
<span class="n">cd</span> <span class="n">src</span><span class="o">/</span><span class="n">layer</span><span class="o">/</span><span class="n">python</span>
<span class="nb">zip</span> <span class="o">-</span><span class="n">r</span> <span class="n">labcas</span><span class="o">-</span><span class="n">mwaa</span><span class="o">-</span><span class="n">restful</span><span class="o">-</span><span class="n">api</span><span class="o">-</span><span class="n">connection</span><span class="o">.</span><span class="n">zip</span> <span class="o">*</span>
</pre></div>
</div>
<p>Upload the zip file as a layer in the AWS console.</p>
</section>
<section id="lambda-functions">
<h2>Lambda functions<a class="headerlink" href="#lambda-functions" title="Link to this heading">¶</a></h2>
<p>Terraform is used to deploy the lambda functions.</p>
<p>Create your deployment environment directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">terraform</span><span class="o">/</span><span class="n">environments</span><span class="o">/</span><span class="n">your_tenant_your_venue_dev</span>
</pre></div>
</div>
<p>Create a terraform state configuration file <code class="docutils literal notranslate"><span class="pre">terraform/environments/your_tenant_your_venue_dev/terraform.tfvars</span></code> with content similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Terraform backend configuration for remote state</span>
<span class="n">bucket</span> <span class="o">=</span> <span class="s2">&quot;&lt;an S3 bucket for your terraform state&gt;&quot;</span>
<span class="n">key</span>    <span class="o">=</span> <span class="s2">&quot;labcas.tfstate&quot;</span>
<span class="n">region</span> <span class="o">=</span> <span class="s2">&quot;&lt;your AWS regision, e.g. us-west-1&gt;&quot;</span>
</pre></div>
</div>
<p>Create a variables file for your deployment configuration in a local file <code class="docutils literal notranslate"><span class="pre">terraform/environments/your_tenant_your_venue_dev/variables.tfvars</span></code> with content similar to:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">maturity</span><span class="o">=</span><span class="p">{</span><span class="n">Maturity</span> <span class="n">level</span> <span class="n">of</span> <span class="n">the</span> <span class="n">deployment</span> <span class="p">(</span><span class="n">poc</span><span class="p">:</span> <span class="n">aws</span> <span class="n">console</span> <span class="n">exploration</span><span class="p">,</span> <span class="n">iac</span><span class="p">:</span> <span class="n">terraform</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">ops</span><span class="p">:</span> <span class="n">full</span> <span class="n">automation</span> <span class="k">with</span> <span class="n">CICD</span> <span class="ow">or</span> <span class="n">SA</span> <span class="n">documented</span> <span class="n">procedures</span><span class="p">)}</span>
<span class="n">stage</span><span class="o">=</span><span class="p">{</span><span class="n">name</span> <span class="n">of</span> <span class="n">a</span> <span class="n">API</span> <span class="n">deployment</span><span class="p">,</span> <span class="n">stage</span> <span class="ow">in</span> <span class="n">AWS</span> <span class="n">API</span> <span class="n">gateway</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">dev</span><span class="p">}</span>
<span class="n">lambda_role_arn</span><span class="o">=</span><span class="p">{</span><span class="k">lambda</span> <span class="n">AM</span> <span class="n">role</span> <span class="n">defined</span> <span class="n">above</span><span class="p">}</span>
<span class="n">aws_region</span><span class="o">=</span><span class="p">{</span><span class="n">your</span> <span class="n">AWS</span> <span class="n">regision</span><span class="p">,</span> <span class="n">e</span><span class="o">.</span><span class="n">g</span><span class="o">.</span> <span class="n">us</span><span class="o">-</span><span class="n">west</span><span class="o">-</span><span class="mi">1</span><span class="p">}</span>
<span class="n">aws_profile</span><span class="o">=</span><span class="p">{</span><span class="n">you</span> <span class="n">AWS</span> <span class="n">CLI</span> <span class="n">profile</span> <span class="n">to</span> <span class="n">use</span><span class="p">}</span>
</pre></div>
</div>
<p>Maturity aims at avoid naming conflict between different maturity of deployment in the same AWS account.
The AWS resources created with the terraform script provided contains the chosen maturity value (poc, iac, ops).
All those value can be used in a dev venue, only the ops or iac can be used in production venues.</p>
<p>Deploy the lambda functions with terraform:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="n">terraform</span><span class="o">/</span><span class="n">application</span><span class="o">/</span><span class="n">modules</span><span class="o">/</span><span class="n">lambdas</span>
<span class="n">terraform</span> <span class="n">init</span> <span class="o">-</span><span class="n">backend</span><span class="o">-</span><span class="n">config</span><span class="o">=../../../</span><span class="n">environments</span><span class="o">/</span><span class="n">your_tenant_your_venue_dev</span><span class="o">/</span><span class="n">terraform</span><span class="o">.</span><span class="n">tfvars</span>
<span class="n">terraform</span> <span class="n">validate</span>
<span class="n">terraform</span> <span class="n">plan</span> <span class="o">-</span><span class="n">var</span><span class="o">-</span><span class="n">file</span><span class="o">=../../../</span><span class="n">environments</span><span class="o">/</span><span class="n">your_tenant_your_venue_dev</span><span class="o">/</span><span class="n">variables</span><span class="o">.</span><span class="n">tfvars</span>
<span class="n">terraform</span> <span class="n">apply</span> <span class="o">-</span><span class="n">var</span><span class="o">-</span><span class="n">file</span><span class="o">=../../../</span><span class="n">environments</span><span class="o">/</span><span class="n">your_tenant_your_venue_dev</span><span class="o">/</span><span class="n">variables</span><span class="o">.</span><span class="n">tfvars</span>
</pre></div>
</div>
<section id="create-the-api-gateway">
<h3>Create the API Gateway<a class="headerlink" href="#create-the-api-gateway" title="Link to this heading">¶</a></h3>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">workflow-api</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Installation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#architecture-overview">Architecture Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#doing-the-installation">Doing the Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="#parameters">Parameters</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lambda-role">lambda role</a></li>
<li class="toctree-l2"><a class="reference internal" href="#layer">Layer</a></li>
<li class="toctree-l2"><a class="reference internal" href="#lambda-functions">Lambda functions</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="use.html">Usage</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="index.html" title="previous chapter">Welcome to the workflow-api documentation!</a></li>
      <li>Next: <a href="use.html" title="next chapter">Usage</a></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Caltech.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
      |
      <a href="_sources/install.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>